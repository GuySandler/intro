const u=["color","fisheye","whirl","pixelate","mosaic","brightness","ghost"],d={};for(let t=0;t<u.length;t++)d[u[t]]=1<<t;const f=(t,e,i)=>{const{effects:s}=t._sprite,n=s._bitmask;if(i[0]=e[0],i[1]=e[1],0!=(n&d.mosaic)){const t=Math.max(1,Math.min(Math.floor(Math.abs(s.mosaic+10)/10+.5),512));i[0]=t*i[0]%1,i[1]=t*i[1]%1}if(0!=(n&d.pixelate)){const e=t.getCurrentSkin(),n=e.width/(.1*Math.abs(s.pixelate)),r=e.height/(.1*Math.abs(s.pixelate));i[0]=(Math.floor(i[0]*n)+.5)/n,i[1]=(Math.floor(i[1]*r)+.5)/r}if(0!=(n&d.whirl)){const t=.017453292519943295,e=i[0]-.5,n=i[1]-.5,r=Math.sqrt(e*e+n*n),o=Math.max(1-2*r,0),a=-s.whirl*t*o*o,h=Math.sin(a),c=Math.cos(a);i[0]=c*e+h*n+.5,i[1]=-h*e+c*n+.5}if(0!=(n&d.fisheye)){const t=(i[0]-.5)/.5,e=(i[1]-.5)/.5,n=Math.sqrt(t*t+e*e)+.001,r=Math.max(0,(s.fisheye+100)/100),o=Math.pow(Math.min(n,1),r)*Math.max(1,n),a=t/n,h=e/n;i[0]=.5+o*a*.5,i[1]=.5+o*h*.5}return i},g=(t,e,i)=>Math.max(e,Math.min(i,t));function _(t,e,i){t/=255,e/=255,i/=255;const s=Math.max(t,e,i),n=s-Math.min(t,e,i);let r=0;0===n||(s===t?r=((e-i)/n+6)%6/6:s===e?r=((i-t)/n+2)%6/6:s===i&&(r=((t-e)/n+4)%6/6));let o=0;return 0!==s&&(o=n/s),{h:100*r,s:100*o,v:100*s}}function m(t,e,i){t=t/100*360;const s=(i/=100)*(e/=100),n=s*(1-Math.abs(t/60%2-1)),r=i-s;let o=r,a=r,h=r;return t<60?(o+=s,a+=n):t<120?(a+=s,o+=n):t<180?(a+=s,h+=n):t<240?(h+=s,a+=n):t<300?(h+=s,o+=n):t<360&&(o+=s,h+=n),{r:255*o,g:255*a,b:255*h}}class p{constructor(t=0,e=0,i=0,s=1){this.h=t,this.s=e,this.v=i,this.a=s}static rgb(t,e,i,s=1){const{h:n,s:r,v:o}=_(t,e,i);return new p(n,r,o,s)}static hsv(t,e,i,s=1){return new p(t,e,i,s)}static num(t){const e=(t=Number(t))>>24&255,i=t>>16&255,s=t>>8&255,n=255&t;return p.rgb(i,s,n,e>0?e/255:1)}get r(){return m(this.h,this.s,this.v).r}set r(t){this._setRGB(t,this.g,this.b)}get g(){return m(this.h,this.s,this.v).g}set g(t){this._setRGB(this.r,t,this.b)}get b(){return m(this.h,this.s,this.v).b}set b(t){this._setRGB(this.r,this.g,t)}get a(){return this._a}set a(t){this._a=g(t,0,1)}get h(){return this._h}set h(t){this._h=(t%100+100)%100}get s(){return this._s}set s(t){this._s=g(t,0,100)}get v(){return this._v}set v(t){this._v=g(t,0,100)}_setRGB(t,e,i){t=g(t,0,255),e=g(e,0,255),i=g(i,0,255);const{h:s,s:n,v:r}=_(t,e,i);this.h=s,this.s=n,this.v=r}toHexString(t=!1){const e=t=>{let e=(t=g(Math.round(t),0,255)).toString(16);return 1===e.length&&(e="0"+e),e};let i="#"+[this.r,this.g,this.b].map(e).join("");return(t||1!==this.a)&&(i+=e(255*this.a)),i}toRGBString(t=!1){const e=[this.r,this.g,this.b].map(Math.round);return t||1!==this.a?`rgba(${e.join(", ")}, ${this.a})`:`rgb(${e.join(", ")})`}toRGBA(){const t=m(this._h,this._s,this._v);return[t.r,t.g,t.b,255*this._a]}toRGBANormalized(){const t=m(this._h,this._s,this._v);return[t.r/255,t.g/255,t.b/255,this._a]}toString(){return this.toRGBString()}}
